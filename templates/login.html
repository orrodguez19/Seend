<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Seend - Mensajería Instantánea</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}
        body{background-color:#f5f7fa;display:flex;justify-content:center;align-items:center;min-height:100vh}
        .container{display:flex;width:900px;background-color:#fff;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.1);overflow:hidden}
        .welcome-section{flex:1;background:linear-gradient(135deg,#1e88e5,#0d47a1);color:#fff;padding:50px;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}
        .welcome-section h1{font-size:32px;margin-bottom:20px;font-weight:700}
        .welcome-section p{font-size:16px;margin-bottom:30px;font-weight:300;line-height:1.6}
        .form-section{flex:1;padding:50px}
        .form-container{display:flex;flex-direction:column;height:100%}
        .form-header{margin-bottom:40px;text-align:center}
        .form-header h2{color:#1e88e5;font-size:28px;font-weight:600;margin-bottom:10px}
        .form-header p{color:#666;font-size:14px}
        .tabs{display:flex;margin-bottom:30px;border-bottom:1px solid #eee}
        .tab{flex:1;text-align:center;padding:10px;cursor:pointer;color:#666;font-weight:500;transition:all .3s ease}
        .tab.active{color:#1e88e5;border-bottom:2px solid #1e88e5}
        .form{display:none;flex-direction:column;flex-grow:1}
        .form.active{display:flex}
        .input-group{margin-bottom:20px}
        .input-group label{display:block;margin-bottom:8px;color:#555;font-size:14px;font-weight:500}
        .input-group input{width:100%;padding:12px 15px;border:1px solid #ddd;border-radius:8px;font-size:14px;transition:border .3s ease}
        .input-group input:focus{border-color:#1e88e5;outline:none}
        .remember-forgot{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;font-size:13px}
        .remember-me{display:flex;align-items:center}
        .remember-me input{margin-right:5px}
        .forgot-password a{color:#1e88e5;text-decoration:none}
        .btn{background-color:#1e88e5;color:#fff;border:none;padding:12px;border-radius:8px;font-size:16px;font-weight:500;cursor:pointer;transition:background-color .3s ease;margin-bottom:20px}
        .btn:hover{background-color:#1565c0}
        .footer{margin-top:auto;text-align:center;font-size:13px;color:#666}
        .footer a{color:#1e88e5;text-decoration:none}
        @media (max-width:768px){.container{flex-direction:column;width:90%}.welcome-section{padding:30px}.form-section{padding:30px}}
        .error-message {color: #ff4444;font-size: 13px;margin-top: 5px;}
    </style>
</head>
<body>
    <div class="container">
        <div class="welcome-section">
            <h1>Bienvenido a Seend</h1>
            <p>Conéctate con amigos, familiares y colegas en tiempo real con nuestra plataforma de mensajería instantánea segura y fácil de usar.</p>
        </div>
        <div class="form-section">
            <div class="form-container">
                <div class="form-header">
                    <h2>Inicia tu experiencia</h2>
                    <p>Ingresa tus datos para comenzar a chatear</p>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('login')">Iniciar Sesión</div>
                    <div class="tab" onclick="switchTab('register')">Registrarse</div>
                </div>
                
                <form class="form active" id="login-form">
                    <div class="input-group">
                        <label for="login-username">Nombre de usuario</label>
                        <input type="text" id="login-username" placeholder="@usuario" required>
                        <div id="login-username-error" class="error-message"></div>
                    </div>
                    <div class="input-group">
                        <label for="login-password">Contraseña</label>
                        <input type="password" id="login-password" placeholder="••••••••" required>
                        <div id="login-password-error" class="error-message"></div>
                    </div>
                    <div class="remember-forgot">
                        <div class="remember-me">
                            <input type="checkbox" id="remember-me">
                            <label for="remember-me">Recordarme</label>
                        </div>
                        <div class="forgot-password"></div>
                    </div>
                    <button type="submit" class="btn">Iniciar Sesión</button>
                    <div class="footer">¿No tienes una cuenta? <a href="#" onclick="switchTab('register')">Regístrate</a></div>
                </form>
                
                <form class="form" id="register-form">
                    <div class="input-group">
                        <label for="register-name">Nombre completo</label>
                        <input type="text" id="register-name" placeholder="Tu nombre" required>
                        <div id="register-name-error" class="error-message"></div>
                    </div>
                    <div class="input-group">
                        <label for="register-username">Nombre de usuario</label>
                        <input type="text" id="register-username" placeholder="@usuario" required>
                        <div id="register-username-error" class="error-message"></div>
                    </div>
                    <div class="input-group">
                        <label for="register-password">Contraseña</label>
                        <input type="password" id="register-password" placeholder="••••••••" required>
                        <div id="register-password-error" class="error-message"></div>
                    </div>
                    <div class="input-group">
                        <label for="register-confirm-password">Confirmar contraseña</label>
                        <input type="password" id="register-confirm-password" placeholder="••••••••" required>
                        <div id="register-confirm-password-error" class="error-message"></div>
                    </div>
                    <button type="submit" class="btn">Registrarse</button>
                    <div class="footer">¿Ya tienes una cuenta? <a href="#" onclick="switchTab('login')">Inicia sesión</a></div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <script>
        // Conectar al servidor Socket.IO
        const socket = io();
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.form').forEach(form => {
                form.classList.remove('active');
            });
            
            if (tabName === 'login') {
                document.querySelector('.tab:nth-child(1)').classList.add('active');
                document.getElementById('login-form').classList.add('active');
            } else {
                document.querySelector('.tab:nth-child(2)').classList.add('active');
                document.getElementById('register-form').classList.add('active');
            }
        }
        
        // Limpiar mensajes de error
        function clearErrors() {
            document.querySelectorAll('.error-message').forEach(el => {
                el.textContent = '';
            });
        }
        
        // Manejar inicio de sesión
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            clearErrors();
            
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;
            
            try {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Login exitoso, redirigir al chat
                    window.location.href = '/chat';
                } else {
                    // Mostrar errores
                    if (data.detail) {
                        document.getElementById('login-username-error').textContent = data.detail;
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('login-username-error').textContent = 'Error de conexión con el servidor';
            }
        });
        
        // Manejar registro
        document.getElementById('register-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            clearErrors();
            
            const name = document.getElementById('register-name').value.trim();
            const username = document.getElementById('register-username').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            // Validación básica del cliente
            if (password !== confirmPassword) {
                document.getElementById('register-confirm-password-error').textContent = 'Las contraseñas no coinciden';
                return;
            }
            
            try {
                const response = await fetch('/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name,
                        username: username,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Registro exitoso, cambiar a pestaña de login
                    switchTab('login');
                    document.getElementById('login-username').value = username;
                    alert('Registro exitoso. Ahora puedes iniciar sesión.');
                } else {
                    // Mostrar errores
                    if (data.detail) {
                        if (typeof data.detail === 'string') {
                            document.getElementById('register-username-error').textContent = data.detail;
                        } else {
                            // Manejar errores de validación
                            for (const error of data.detail) {
                                const field = error.loc[1];
                                const message = error.msg;
                                const errorElement = document.getElementById(`register-${field}-error`);
                                if (errorElement) {
                                    errorElement.textContent = message;
                                }
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('register-username-error').textContent = 'Error de conexión con el servidor';
            }
        });
    </script>
</body>
</html>